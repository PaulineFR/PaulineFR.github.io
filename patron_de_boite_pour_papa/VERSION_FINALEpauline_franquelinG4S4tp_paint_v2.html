<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP Paint</title>
    <style>
        #wrapper {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #button {
            width: 50px;
            height: 20px;
            position: relative;
            margin-bottom: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.1s ease-in-out;
            box-shadow: -6px -6px 10px rgba(255, 255, 255, 0.8), 6px 6px 10px rgba(0, 0, 0, 0.2);
            display: table-cell;
            vertical-align: middle;
            font-weight: bold;
        }

        #button.pressed {
            box-shadow: inset -4px -4px 8px rgba(255, 255, 255, 0.5), inset 8px 8px 16px rgba(0, 0, 0, 0.1);
        }

        #button-checkbox {
            display: none;
        }
    </style>
</head>

<body onload="drawC();">
    <canvas id="canvas" width="600" height="400"></canvas>
    <h1>TP Paint | Pauline Franquelin | G4S4</h1>
    <h6>Color</h6>
    <input id="penColor" type="color" onchange="changePenColor();">
    <h6>Bg Color</h6>
    <input id="bgColor" type="color" onchange="changeBgColor();" value="#ffffff">
    <h6>Eraser</h6>
    <label for="button-checkbox">
        <div id="button">⌦</div>
    </label>
    <input type="checkbox" name="" id="button-checkbox">
    <p> ↑ cliquez une fois pour gommer, recliquez pour dessiner !</p>
    <h6>Reset</h6>
    <button onclick="reset();" style="width: 50px;height: 20px;">Ø</button>
    <h6></h6>
    <input id="penSize" type="range" min="1" max="50" value="2" onchange="changePenSize();">
    <h6>Download</h6>
    <a className="download-link" href="" download="monImage.png">⇓ here ⇓</a>
    <p>/!\ Attention! Télécharger votre dessin l'effacera du canevas !</p>
</body>

<script>
    var canevas = document.getElementById('canvas');
    var ctx = canevas.getContext('2d');
    var anc_posX, anc_posY;
    var down = false;
    var hover = false;
    /* change la forme de la souris au dessus du canevas */
    canevas.addEventListener('mouseover', function (evt) {
        hover = true;
        canevas.style.cursor = "crosshair";
    });
    canevas.addEventListener('mouseout', function (evt) {
        hover = false;
        canevas.style.cursor = "default";
    });
    /* pour télécharger le dessin */
    document.getElementsByTagName('a')[0].addEventListener("click", function (evt) {
        var bgColor = document.getElementById('bgColor');
        ctx.globalCompositeOperation = "destination-over";
        ctx.fillStyle = bgColor.value;
        ctx.fillRect(1, 1, canvas.width - 2, canvas.height - 2);
        ctx.globalCompositeOperation = "source-over";
        var dataURL = canevas.toDataURL();
        evt.target.href = dataURL;
        reset();
    });
    /* dessine */
    document.addEventListener("mousedown", function (evt) {
        down = true;
        var mouseX = evt.offsetX;
        var mouseY = evt.offsetY;
        //console.log("x:" + mouseX + " y:" + mouseY);
        anc_posX = mouseX;
        anc_posY = mouseY;
        ctx.beginPath();
        ctx.moveTo(anc_posX, anc_posY);
    });
    document.addEventListener("mouseup", function (evt) {
        down = false;
    });
    document.addEventListener("mousemove", function (evt) {
        if (down && hover) {
            var mouseX = evt.offsetX;
            var mouseY = evt.offsetY;
            ctx.lineTo(mouseX, mouseY);
            ctx.stroke();
            anc_posX = mouseX;
            anc_posY = mouseY;
        }
    });
    /* activer ou désactiver la gomme */
    document.getElementById("button-checkbox").addEventListener("input", function (evt) {
        document.getElementById("button").classList.toggle("pressed");
        if (evt.target.checked) {
            var bgColor = document.getElementById('bgColor');
            ctx.globalCompositeOperation = "destination-out";
        } else {
            var penColor = document.getElementById('penColor');
            ctx.globalCompositeOperation = "source-over";
        }
    });
    /* change la couleur du pinceau */
    function changePenColor() {
        var penColor = document.getElementById('penColor');
        //console.log(penColor.value);
        ctx.strokeStyle = penColor.value;
        if (document.getElementById("button-checkbox").checked) {
            document.getElementById("button").classList.remove("pressed");
            document.getElementById("button-checkbox").checked = false;
            ctx.globalCompositeOperation = "source-over";
        }
    }
    /* change la couleur du background */
    function changeBgColor() {
        var bgColor = document.getElementById('bgColor');
        canevas.style.backgroundColor = bgColor.value;
    }
    /* remet tout à zéro */
    function reset() {
        if (document.getElementById("button-checkbox").checked) {
            document.getElementById("button").classList.remove("pressed");
            document.getElementById("button-checkbox").checked = false;
            ctx.globalCompositeOperation = "source-over";
        }
        var bgColor = document.getElementById('bgColor');
        var penColor = document.getElementById('penColor');
        bgColor.value = "#ffffff";
        penColor.value = "#000000";
        ctx.fillStyle = bgColor.value;
        ctx.strokeStyle = penColor.value;
        document.getElementsByTagName('h6')[4].innerHTML = "Size (" + 2 + ")";
        document.getElementById('penSize').value = 2;
        ctx.lineWidth = 2;
        ctx.clearRect(1, 1, canvas.width - 2, canvas.height - 2);
        canevas.style.backgroundColor = bgColor.value;
        ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
    }
    /* change la taille tu pinceau */
    function changePenSize() {
        var texte = document.getElementsByTagName('h6')[4];
        var penSize = document.getElementById('penSize');
        //console.log(penSize.value);
        ctx.lineWidth = penSize.value;
        texte.innerHTML = "Size (" + penSize.value + ")";
    }
    /* dessine le canevas */
    function drawC() {
        var texte = document.getElementsByTagName('h6')[4];
        var penSize = document.getElementById('penSize');
        //console.log(penSize.value);
        ctx.lineWidth = penSize.value;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        var bgColor = document.getElementById('bgColor');
        //console.log(bgColor.value);
        ctx.fillStyle = bgColor.value;
        ctx.fill();
        texte.innerHTML = "Size (" + penSize.value + ")";
        ctx.moveTo(0, 0);
        ctx.lineTo(0, 400);
        ctx.lineTo(600, 400);
        ctx.lineTo(600, 0);
        ctx.lineTo(0, 0);
        ctx.stroke();
    }
</script>

</html>